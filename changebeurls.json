[{"id":5301,"title":"Change BE urls","code":"document.addEventListener('DOMContentLoaded', function () {\r\n  function getUrlParams() {\r\n    const params = new URLSearchParams(window.location.search);\r\n    let paramsObject = {};\r\n\r\n    if (params.toString()) {\r\n        for (const [key, value] of params.entries()) {\r\n            paramsObject[key] = value;\r\n        }\r\n        return paramsObject;\r\n    }\r\n\r\n    const storedParams = localStorage.getItem('urlParams');\r\n    if (storedParams) {\r\n        const parsedParams = JSON.parse(storedParams);\r\n        \r\n        \/\/ Check if the item has expired\r\n        const now = new Date();\r\n        if (parsedParams.expiry && now.getTime() > parsedParams.expiry) {\r\n            console.log('Stored URL parameters have expired');\r\n            return paramsObject;  \/\/ Return empty object since params are expired\r\n        }\r\n\r\n        return parsedParams.value;\r\n    }\r\n\r\n    return paramsObject;\r\n  }\r\n\r\n  function setLocalStorageWithExpiry(key, value, ttl) {\r\n      const now = new Date();\r\n      const item = {\r\n          value: value,\r\n          expiry: now.getTime() + ttl\r\n      };\r\n      localStorage.setItem(key, JSON.stringify(item));\r\n  }\r\n\r\n  function saveParamsToLocalStorageWithExpiry(ttl) {\r\n      const urlParams = getUrlParams();\r\n      setLocalStorageWithExpiry('urlParams', urlParams, ttl);\r\n  }\r\n\r\n  var ttl = 45 * 24 * 60 * 60 * 1000 \/\/ 45 dias\r\n  saveParamsToLocalStorageWithExpiry(ttl);\r\n\r\n  function addLocalStorageParamsToUrl() {\r\n    const storedParams = localStorage.getItem('urlParams');\r\n    \r\n    if (storedParams) {\r\n        const parsedParams = JSON.parse(storedParams);\r\n        \r\n        const now = new Date();\r\n        if (parsedParams.expiry && now.getTime() > parsedParams.expiry) {\r\n            console.log('Stored URL parameters have expired');\r\n            return;\r\n        }\r\n\r\n        const urlParams = new URLSearchParams(parsedParams.value);\r\n        \/\/ Append the parameters to the current URL\r\n        \/\/ const newUrl = `${window.location.pathname}?${urlParams.toString()}`;\r\n        \/\/ window.history.replaceState(null, '', newUrl);\r\n        return urlParams.toString()\r\n    } else {\r\n        console.log('No URL parameters found in localStorage');\r\n    }\r\n  }\r\n\r\n  addLocalStorageParamsToUrl();\r\n\r\n  function changeFormAction() {\r\n    var cubilisReservationForms = document.querySelectorAll('form[action^=\"https:\/\/reservations.cubilis.eu\"]')\r\n    var cubilisReservationLinks = document.querySelectorAll('a[href^=\"https:\/\/reservations.cubilis.eu\"]')\r\n    var hoteliersReservationLinks = document.querySelectorAll('a[href^=\"https:\/\/ibe.hoteliers.guru\"]')\r\n    var hoteliersReservationForms = document.querySelectorAll('form[action^=\"https:\/\/ibe.hoteliers.guru\"]')\r\n    var url = '?'\r\n\r\n    if (localStorage.getItem('urlParams')) {\r\n      url += addLocalStorageParamsToUrl()\r\n    }\r\n\r\n    \/\/ Cubilis\r\n    if (cubilisReservationForms.length > 0) {\r\n      Array.from(cubilisReservationForms).forEach(function (reservationForm) {\r\n        reservationForm.querySelector('#startdate').setAttribute('required', 'required')\r\n        reservationForm.querySelector('#enddate').setAttribute('required', 'required')\r\n\r\n        reservationForm.action += url\r\n      })\r\n    }\r\n\r\n    if (cubilisReservationLinks.length > 0) {\r\n      Array.from(cubilisReservationLinks).forEach(function (reservationLink) {\r\n        reservationLink.href += url\r\n      })\r\n    }\r\n\r\n    \/\/ Dirs\r\n    if (document.querySelectorAll('.d21-trigger-ibe').length > 0) {\r\n      let d21Trigger = document.querySelectorAll('.d21-trigger-ibe')\r\n\r\n      d21Trigger.forEach(function (trigger) {\r\n        trigger.addEventListener('click', function () {\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tlet dirsIframeContainer = document.querySelector('#d21-modal-fullsize')\r\n\t\t\t\tif (dirsIframeContainer) {\r\n\t\t\t\t\tlet dirsIframe = dirsIframeContainer.querySelector('iframe')\r\n\t\t\t\t\tconsole.log('dirsIframe: ' + dirsIframe)\r\n\t\t\t\t\tif (dirsIframe) {\r\n\t\t\t\t\t\tdirsIframe.addEventListener('load', function () {\r\n\t\t\t\t\t\t\tthis.src += url\r\n\t\t\t\t\t\t}, { once: true })\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, 2000)\r\n\t\t})\r\n      })\r\n    }\r\n\r\n    \/\/ Hoteliers Guru\r\n    if (hoteliersReservationLinks.length > 0) {\r\n      Array.from(hoteliersReservationLinks).forEach(function (hoteliersReservationLink) {\r\n        hoteliersReservationLink.href += url\r\n      })\r\n    }\r\n\r\n    if (hoteliersReservationForms.length > 0) {\r\n      Array.from(hoteliersReservationForms).forEach(function (reservationForm) {\r\n        reservationForm.action += url\r\n      })\r\n    }\r\n  }\r\n\r\n  changeFormAction()\r\n})","code_type":"js","location":"site_wide_footer","auto_insert":1,"insert_number":1,"use_rules":false,"rules":[],"priority":10,"location_extra":"","shortcode_attributes":[],"tags":[],"note":"","cloud_id":false,"custom_shortcode":""}]
