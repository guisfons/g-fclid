[{"id":2390,"title":"Change Cubilis urls","code":"document.addEventListener('DOMContentLoaded', function () {\r\n  function setLocalStorageWithExpiry(key, value, ttl) {\r\n    var now = new Date()\r\n    var item = {\r\n      value: value,\r\n      expiry: now.getTime() + ttl\r\n    }\r\n    localStorage.setItem(key, JSON.stringify(item))\r\n  }\r\n\r\n  function getLocalStorageWithExpiry(key) {\r\n    var itemStr = localStorage.getItem(key)\r\n    if (!itemStr) {\r\n      return null\r\n    }\r\n    var item = JSON.parse(itemStr)\r\n    var now = new Date()\r\n    if (now.getTime() > item.expiry) {\r\n      localStorage.removeItem(key)\r\n      return null\r\n    }\r\n    return item.value\r\n  }\r\n\r\n  var urlParams = new URLSearchParams(window.location.search)\r\n  var gclid = urlParams.get('gclid')\r\n  var fclid = urlParams.get('fclid')\r\n  var ttl = 45 * 24 * 60 * 60 * 1000\r\n\r\n  if (gclid) {\r\n    var storedGclid = getLocalStorageWithExpiry('gclid')\r\n    if (storedGclid !== gclid) {\r\n      setLocalStorageWithExpiry('gclid', gclid, ttl)\r\n    }\r\n  }\r\n\r\n  if (fclid) {\r\n    var storedFclid = getLocalStorageWithExpiry('fclid')\r\n    if (storedFclid !== fclid) {\r\n      setLocalStorageWithExpiry('fclid', fclid, ttl)\r\n    }\r\n  }\r\n\r\n  function changeFormAction() {\r\n    var cubilisReservationForms = document.querySelectorAll('form[action^=\"https:\/\/reservations.cubilis.eu\"]')\r\n    var cubilisReservationLinks = document.querySelectorAll('a[href^=\"https:\/\/reservations.cubilis.eu\"]')\r\n    var hoteliersReservationLinks = document.querySelectorAll('a[href^=\"https:\/\/ibe.hoteliers.guru\"]')\r\n    var hoteliersReservationForms = document.querySelectorAll('form[action^=\"https:\/\/ibe.hoteliers.guru\"]')\r\n    var url = ''\r\n\r\n    if (localStorage.getItem('gclid')) {\r\n      url += '?gclid=' + JSON.parse(localStorage.getItem('gclid')).value + '&'\r\n    }\r\n\r\n    if (localStorage.getItem('fclid')) {\r\n      url += '?fclid=' + JSON.parse(localStorage.getItem('fclid')).value + '&'\r\n    }\r\n\r\n    \/\/ Cubilis\r\n    if (cubilisReservationForms.length > 0) {\r\n      Array.from(cubilisReservationForms).forEach(function (reservationForm) {\r\n        reservationForm.querySelector('#startdate').setAttribute('required', 'required')\r\n        reservationForm.querySelector('#enddate').setAttribute('required', 'required')\r\n\r\n        reservationForm.action += url\r\n      })\r\n    }\r\n\r\n    if (cubilisReservationLinks.length > 0) {\r\n      Array.from(cubilisReservationLinks).forEach(function (reservationLink) {\r\n        reservationLink.href += url\r\n      })\r\n    }\r\n\r\n    \/\/ Dirs\r\n    if (document.querySelectorAll('.d21-trigger-ibe').length > 0) {\r\n      let d21Trigger = document.querySelectorAll('.d21-trigger-ibe')\r\n\r\n      d21Trigger.forEach(function (trigger) {\r\n        trigger.addEventListener('click', function () {\r\n          let dirsIframeContainer = document.querySelector('#d21-modal-fullsize')\r\n          if (dirsIframeContainer) {\r\n            let dirsIframe = dirsIframeContainer.querySelector('iframe')\r\n            if (dirsIframe && !dirsIframe.src.includes('gclid') && !dirsIframe.src.includes('fclid')) {\r\n              dirsIframe.addEventListener('load', function () {\r\n                this.src += url\r\n              }, { once: true })\r\n            }\r\n          }\r\n        })\r\n      })\r\n    }\r\n\r\n    \/\/ Hoteliers Guru\r\n    if (hoteliersReservationLinks.length > 0) {\r\n      Array.from(hoteliersReservationLinks).forEach(function (hoteliersReservationLink) {\r\n        hoteliersReservationLink.href += url\r\n      })\r\n    }\r\n\r\n    if (hoteliersReservationForms.length > 0) {\r\n      Array.from(hoteliersReservationForms).forEach(function (reservationForm) {\r\n        reservationForm.action += url\r\n      })\r\n    }\r\n  }\r\n\r\n  changeFormAction()\r\n})","code_type":"js","location":"site_wide_footer","auto_insert":1,"insert_number":1,"use_rules":false,"rules":[],"priority":10,"tags":[],"note":""}]